\section{Stakeholders Requirements} \label{sec:reqs}

This section address the questions:

\textbf{Why are DM software releases needed? Who is requesting them ?}

The classic answer to the second questions is that  stakeholders request releases for various reasons.

The following subsections summarize the release requirements on \gls{DM} software products from the different stakeholders' points of view.

It is important to identify these requirements and the corresponding policies during the construction phase, in order to have them consolidated when operations start.

In operations, some of the \gls{LSST} subsystems may no longer exist, for example, \gls{DM} will not exist per se but \gls{DM} software products will still exist under another managerial structure.
The requirements and policies defined here will still be applicable since many of the stakeholders will still expect software releases to be managed following the process consolidated during construction.


\subsection{Release Requirements for the \gls{LSST} Project} \label{sec:lsstreqs}

The main reason for DM to do software releases is to fulfill the project outcome: provide the Data Products.

In order to do that, software releases shall:

\begin{itemize}
\item be available on a time base cadence (every 6 months) during the construction phase,
\item be available when required by a project milestone, in order to be used for the proper validation (commissioning) and operations activities,
\item implement the  functionality needed for the milestone or phase of the project,
\item include third-party software from the Science Community when this is beneficial to the project outcome,
\item carry an appropriate source code license to permit contributions from the Science Community.
\end{itemize}


\subsection{Release Requirements for the \gls{LSST} Science Community} \label{sec:comreqs}

In preparation for working with the \gls{LSST} data products and software during operations, several \gls{LSST} science collaborations have begun using the \gls{DM} software to run data challenges using precursor data or simulations, and to do performance studies. These activities effectively increase the number of beta-testers of \gls{DM} software products, providing valuable feedback to \gls{DM} on the state of the system.

In order to work effectively with the \gls{DM} software while it is still under development, the science community require:
\begin{itemize}
\item timely access new functionality
\item stable public APIs and schemas in order to build software for User-Generated analyses,
\item patches and bug fixes back-ported to the current stable version of the software,
\item include software provided by external contributors in a software release or distribution (due to the collaborative nature of the project).
\end{itemize}


\subsection{Release Requirements for Data Processing in Operations} \label{sec:procreqs}

The \gls{LDF} will be responsible for generating the necessary data products during commissioning and operations.
The \gls{LDF} requires officially released software to be used in production for the various operational activities.
Software releases will be run in production at National \gls{Center} for Supercomputing Applications (\gls{NCSA}), CC-IN2P3 and in Chile, and possibly at independent Data Access Centers (iDACs).

Release frequencies will depend on the processing type:
\begin{itemize}
\item Prompt Processing requires releases to be available very quick, that could happen on a daily bases, especially in the early days (official releases)
 or a  patch release  for a specific problem may be required during the night (this would require sign off from the \gls{AD} for Science \gls{Operations}).
\item \gls{DRP} processing  must be stable for long periods, currently processing is foreseen to take 9 months.  Before such a long processing run the release must be very well tested and any updates extremely well controlled.
\item Image acquisition and header service, which form part of the image acquisition on the mountain will also need strict change control. Releases for this could be on monthly or even lounge timescales - however if there is a problem a patch will be needed immediately.
\end{itemize}

Patch releases need to be provided with a frequency that depends on the type of processing
and on the urgency of the problems to be fixed.


\subsection{Release Requirements for \gls{LSST} Subsystems in \gls{Operations}.} \label{sec:otherreqs}

Other \gls{LSST} subsystem may be consumers of \gls{DM} software products, for example the Telescope \& Site subsystem software makes use of the \gls{DM} software products.
In order for \gls{DM} to be able to respond correctly to the needs of other \gls{LSST} subsystems, it is important to first identify which \gls{DM} software products are used, and how they are used.


\subsection{Release Requirements for Infrastructural Software} \label{sec:infreqs}

A significant subset of \gls{DM} software products are used to provide services to \gls{LSST} science users and staff but are not directly used to generate \gls{LSST} science data products. An example of this is the software that implements the \gls{LSST} \gls{Science Platform} (\gls{LSP}).

Releases of this type of software are typically on their own cadence and need to be adequately tested before deployment to ensure a stable infrastructure.
The releases may be tied to processing milestones if the services or features thereof are required for the processing (e.g. functionality of the workflow service may be required for \gls{Data Release} processing and features in the \gls{LSP} may be needed for \gls{QA} of data products).

Patch releases may need to be provided depending on the urgency and severity of the problems to be fixed.


\subsection{Release Requirements for non-Operational Project Activities} \label{sec:nonopsreqs}

This includes activities done in preparation for operations, such as commissioning,
large scale integration/validation test campaigns, etc. These activities should use use,  as much as possible,  officially released software.

In some cases however, it is necessary to use non-released software, such as release candidates or stable builds.
In all cases, the software used must be clearly identified (Github revision at least), and the distribution/deployment strictly controlled.


\newpage
\section{Requirements Consolidation} \label{sec:reqdef}

The main purpose of this section is to identify all possible release requirements.
In the first subsection, a few general requirements are given.
The second subsection summarizes the requirements given by the stakeholders.

A summary overview of the requirements per stakeholder is given at the end of the section.


\subsection{General Requirements} \label{sec:genreq}

The following general requirements are needed in order to properly implement the release process.


\subsubsection{Software Products Identification Requirement} \label{sec:swid}

All \gls{SW} products shall be clearly and unequivocally identifiable in the source repository (GitHub) and documented.

\citeds{DMTN-106} subsection 2.2 (see \ref{sec:defs}) provides a software product definition that can be used as a starting point to identify the DM software products.
The DM product tree provided together with \citeds{LDM-294}, is available at the following link \url{https://ldm-294.lsst.io/ProductTreeLand.pdf}.

This requirement needs to be fulfilled in order to ensure the applicability of the release policy and process.
If the software products are not properly identified, it will not be possible to do releases.


\subsubsection{Software Release Documentation Requirement} \label{sec:reqdoc}

All software releases shall be properly documented with a software release note.


\subsubsection{Software Release Test Requirement} \label{sec:test}

A software release should be fully tested before making it available for use.
The test should be documented in a test report.


\subsection{Stakeholders Requirements} \label{sec:stakeholdersreqs}

The following list of requirements is derived from the above section \ref{sec:reqs}.


\subsubsection{Releases Schedule Requirement} \label{sec:milestone}

Releases on a software product shall be scheduled in advance.

Two types of release schedule can be identified:

\begin{itemize}
\item Functional Based Release Schedule: a release shall provide a requested functionality.
\item Time-Based Release Schedule: a release shall be provided on a specific date or cadence.
\end{itemize}

In both cases, releases can be tight to project milestones.
Additional releases can be requested to the DM-CCB using the RFC mechanism.


\subsubsection{Patch Release Requirement} \label{sec:backport}

It shall be possible to backport a fix on a stable release and provide a patch release including only the backported fix.


\subsubsection{Third-Party Software Inclusion Requirement} \label{sec:thirdsw}

It shall be possible to include in a software product release or distribution release, a software package provided by a third-party contributor.


\subsubsection{Stable public APIs and Schemas Requirement} \label{sec:stable}

Public APIs and schemas shall be stable and follow a well-defined deprecation mechanism in order to give time to the stakeholder to adapt to the new API.


\subsubsection{License Requirement} \label{sec:license}

DM software shall be released with an appropriate license, that permits to use and redistribution of software provided by external collaborators.


\subsection{Requirements Summary Overview} \label{sec:overview}

The following table gives an overview of the release requirements applicable for each stakeholder.

\setlength\LTleft{-0.4in}
\setlength\LTright{-0.5in}
\begin{longtable}{p{2.4cm}p{1.2cm}p{1.4cm}p{1.4cm}p{1.3cm}p{1.3cm}p{1.3cm}p{1.7cm}p{1.3cm}p{1.3cm}}\hline
&
\textbf{SW Ident.}&\textbf{Release Doc.}&\textbf{Release Test}&\textbf{Funct. Based}&\textbf{Time Based}&\textbf{Patch}&\textbf{3rd Party SW}&\textbf{Stable API} &\textbf{Policy}\\ \hline
\textbf{LSST Project} \ref{sec:lsstreqs}&
YES                     & YES                         & YES                         &  YES                         &  YES                      & YES             & YES                          &  YES.                   & YES   \\ \hline
\textbf{Science Community} \ref{sec:comreqs}&
YES                     & YES                         &                                 &                                   &  YES                     & YES.            & YES                          &  YES.                   & YES   \\ \hline
\textbf{DM Operations} \ref{sec:procreqs}&
YES                     & YES                         & YES                         & YES                           &                              & YES             & YES                          &  YES(?)                &            \\ \hline
\textbf{Other Operations} \ref{sec:otherreqs}&
YES                     & YES                         & YES                         & YES                           &                              & YES             &                                  &  YES(?)                &            \\ \hline
\textbf{Infrastructure} \ref{sec:infreqs}&
YES                     & YES                         & YES                         &                                   &  YES                     & YES             &                                  &  YES                    &            \\ \hline
\textbf{Non Operations} \ref{sec:nonopsreqs}&
YES                     & YES(?)                     & YES(?)                    & YES                           &  YES                     & YES             & YES                          &  YES                    &            \\ \hline
\hline
\end{longtable}
\setlength\LTleft{0in}
\setlength\LTright{0in}


